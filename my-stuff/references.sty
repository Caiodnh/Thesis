% * The packages below must be called in this order to work properly

% ** Hyperref is used for links and for the pdfa requirements
%    The `hypertexnames=false` is to avoid warnings from the use of 
%    the Autonum package (see below)
\RequirePackage[hypertexnames=false]{hyperref}

%    A interesting thing it brings is the `\phantomsection` to refer to paragraphs
%    In the example below, \cref{defi:rational-numbers} will be substituted by Subsection xx 
%    with a link to the position of the \phantomsection command:
%    
%    \subsection{subsec:numbers}
%    
%    There natural numbers and integers.
%
%    \phantomsection\label{def:rational-numbers}
%    
%    The rational numbers are defined as pairs of integers under an equivalece relation.

% ** Cleverref put the name of the enviroment (e.g., Definition, Theorem, Chapter) 
%    automatically in front of the number.
%    The options below is to have with capital letters and without abbreviations
\RequirePackage[capitalise,noabbrev]{cleveref}

%    For some reason, subsections don't work with \cref out of the box
\crefname{subsection}{Subsection}{Subsections}  

%    \cref will also capitalise items, which we don't want to. 
%    I also like to use paretheses around the lowercase roman algarism, and
%    the default is the algarism with no parethesis, so we need to customise it further.
%    The command \Cref, with capital C, should be used at the begining of a sentence,
%    to force capitalization.
\crefformat{enumi}{item~(#2#1#3)}
\crefrangeformat{enumi}{items~(#3#1#4) to~(#5#2#6)}
\crefmultiformat{enumi}{items~(#2#1#3)}{ and~(#2#1#3)}{, (#2#1#3)}{ and~(#2#1#3)}

% ** Autonum makes only the refered equations to be numbered, in a way that is
%    compatible with Cleverref
%    It also redefines \[ \] to be the same as an equation enviroment, so we can label it:
%    \[\label{eq:two-plus-two}
%       2 + 2 = 4
%    \]

%    The next two commands are to remove a strange warning from using autonum
\expandafter\def\csname ver@etex.sty\endcsname{3000/12/31}
\let\globcount\newcount
\RequirePackage{autonum}

%    Autonum deactivates all starred environments because they are "useless".
%    This causes many errors since it is incompatible with old files.
%    The code below is to correct this:
\makeatletter
\newcommand{\restore@Environment}[1]{%
  \AtBeginDocument{%
    \csletcs{#1*}{#1}%
    \csletcs{end#1*}{end#1}%
  }%
}
\forcsvlist\restore@Environment{alignat,equation,gather,multline,flalign,align}
\makeatother
